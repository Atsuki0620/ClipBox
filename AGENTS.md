# Repository Guidelines

## プロジェクト構成と配置
本リポジトリは Streamlit ベースの動画管理アプリです。エントリーポイントは `streamlit_app.py`。ドメインロジックと DB 操作は `core/` 配下（例: `core/app_service.py`, `core/video_manager.py`）、設定は `config.py` と `data/user_config.json`（生成される場合あり）、テストは `tests/`、設計資料や計画は `docs/` に置かれています。動画や一時ファイルは `data/` 配下で扱う想定です（リポジトリには含めないでください）。

## ビルド・テスト・開発コマンド
- 依存インストール: `python -m pip install -r requirements.txt`
- 開発サーバ: `python -m streamlit run streamlit_app.py --server.port 8501`
- 静的チェック/コンパイル確認: `python -m py_compile streamlit_app.py core/*.py`
- 単体テスト: `python -m pytest` （`tests/` 配下に自動検出されます）
ローカル検証は仮想環境 `venv/` を有効化してから実行してください。Port 8501 が使用中の場合は `--server.port` を変更します。

## コーディングスタイルと命名
Python で 4 スペースインデント、型ヒントを必須とし、f-string を優先します。関数・変数は `snake_case`、クラスは `PascalCase`。ユーザー表示用テキストは UTF-8 で日本語を正しく記述し、文字化けを避けるため英数字との混在時も全角・半角を意識します。副作用のある処理はサービス層（`core/`）に寄せ、UI 層（Streamlit）は薄く保ちます。

## テスト指針
`tests/` 直下に `test_*.py` を置き、主要ユースケース（フィルタの組み合わせ、DB 更新/検知、表示ソートなど）をカバーしてください。モックを用いてファイルシステム依存を最小化し、回帰バグが出やすいフィルタ初期値と可用性判定の分岐にはパラメトリックテストを追加します。新規機能では最低でも正常系＋主要な異常系の 2 ケースを追加し、失敗時メッセージを日本語で明確にすること。

## コミットとプルリクエスト
コミットメッセージは `feat: ...`, `fix: ...`, `docs: ...`, `refactor: ...` などの Conventional Commits 形式を踏襲します。PR では目的、変更概要、テスト結果（コマンドと要約）、影響範囲（DB 変更の有無、設定ファイルの追加の有無）を簡潔に記載してください。UI 変更を含む場合はスクリーンショットを添付し、既存の検索・ランダム再生との干渉有無を述べるとレビュアーが助かります。

## セキュリティと設定の扱い
`data/` 配下の実データや個人設定ファイルはコミットしないでください（`.gitignore` により除外済み）。外部ストレージやパス情報を変更する際は `user_config.json` のサンプルを提示し、秘匿情報（パスワード・トークン）は絶対に含めないこと。ログやスクリーンショットを共有する際も個人情報が含まれていないか確認してください。
