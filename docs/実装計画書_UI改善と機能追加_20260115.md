# å‹•ç”»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  æ©Ÿèƒ½æ”¹å–„å®Ÿè£…è¨ˆç”»æ›¸

**ä½œæˆæ—¥**: 2026-01-15
**å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: ClipBoxï¼ˆå‹•ç”»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0

---


## Progress Log (2026-01-15)
- Phase1 foundation: added `judgment_history` table and `core/migration.py`; all tests passed via `python -m pytest`.
- Migration run: observed Streamlit info banner "903 ä»¶ã®å‹•ç”»ã‚’ãƒ¬ãƒ™ãƒ«0ã‹ã‚‰ãƒ¬ãƒ™ãƒ«-1ã«å¤‰æ›´ã—ã¾ã—ãŸ" after executing `migrate_level_0_to_minus_1` (checked with Playwright scroll).
- Filename parsing: updated `extract_essential_filename` to treat `?_` and no prefix as level -1.
- Tests: added `tests/test_migration.py`; refreshed `tests/test_scanner.py` for new rules.
- Phase2 components: created `ui/components/kpi_display.py`, `display_settings.py`, `video_card.py` with KPI helper,è¡¨ç¤ºè¨­å®šUIã€ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ`python -m py_compile`ã§æ¤œè¨¼æ¸ˆã¿ï¼‰ã€‚
- Phase3-4 UI: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¿ãƒ–ã‚’æ–°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ(KPI/è¡¨ç¤ºè¨­å®š/ã‚«ãƒ¼ãƒ‰)ã«å·®ã—æ›¿ãˆã€æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã‚’è¿½åŠ ã€‚ãƒ¬ãƒ™ãƒ«-1ãƒ•ã‚£ãƒ«ã‚¿&ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¯¾å¿œã€ã‚­ãƒ¼é‡è¤‡ã‚’è§£æ¶ˆã™ã‚‹ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å°å…¥ã€‚
- Dependencies: `plotly`ã‚’requirementsã«è¿½åŠ ã—ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€Playwrightã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¿ãƒ–ã‚’ç¢ºèªï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ¬ å¦‚/ã‚­ãƒ¼é‡è¤‡ã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£å¾Œã«å†ç¢ºèªï¼‰ã€‚
- Phase5-6 UX/è¨ˆæ¸¬: åˆ¤å®šå‡¦ç†ã§ãƒªãƒãƒ¼ãƒ æ™‚é–“ã‚’`judgment_history`ã¸è¨˜éŒ²ã—ã€åˆ†æã‚¿ãƒ–ã«å¿œç­”é€Ÿåº¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—æ™‚ã¯æ¡ˆå†…ï¼‰ã‚’è¿½åŠ ã€‚å†ç”Ÿ/åˆ¤å®šã§ã‚«ãƒ¼ãƒ‰å¼·èª¿ãŒæ®‹ã‚‹ã‚ˆã†ã«é¸æŠçŠ¶æ…‹ã‚’ä¿æŒã€‚
- Tests: `test_set_favorite_level_with_rename_logs_history`ã‚’è¿½åŠ ã—ã€`python -m pytest`ã§15ä»¶ã™ã¹ã¦Passï¼ˆè­¦å‘Šã¯sqlite datetime adapterã®Deprecationï¼‰ã€‚
- Playwright checks: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¿ãƒ–ï¼†åˆ†æã‚¿ãƒ–ã‚’èµ·å‹•ãƒ»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã‚¨ãƒ©ãƒ¼ãªã—ã‚’ç¢ºèªï¼ˆæœ€æ–°ãƒ“ãƒ«ãƒ‰ï¼‰ã€‚
- Playwright check 2: æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã‚’é–‹ã„ã¦KPIãƒ»è¡¨ç¤ºè¨­å®šãƒ»ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºãŒæ­£ã—ãæç”»ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã€‚é‡è¤‡ã‚­ãƒ¼ãªã—ã§ãƒ­ãƒ¼ãƒ‰æˆåŠŸã€‚
- Plotlyç§»è¡Œ: åˆ†æã‚¿ãƒ–ã®ãƒ¬ãƒ™ãƒ«åˆ¥/æ¨ç§»/åˆ†å¸ƒã‚°ãƒ©ãƒ•ã‚’Plotlyã«å·®ã—æ›¿ãˆã€å¿œç­”é€Ÿåº¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¨åˆã‚ã›ã¦å…¨ã¦PlotlyåŒ–ã€‚
- æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã®å®‰å®šåŒ–: ã‚·ãƒ£ãƒƒãƒ•ãƒ«æŠ¼ä¸‹æ™‚ã®ã¿ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡ºã‚’æ›´æ–°ã—ã€å†ç”Ÿ/åˆ¤å®šãƒœã‚¿ãƒ³ã«ã‚ˆã‚‹è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ã§ã‚‚åŒã˜ã‚µãƒ³ãƒ—ãƒ«ã‚’ä¿æŒã€‚ã‚«ãƒ¼ãƒ‰æ ãƒ»èƒŒæ™¯å¼·èª¿ã‚’borderä»˜ãã‚³ãƒ³ãƒ†ãƒŠã§å¾©å…ƒã€‚
- **2026-01-16 ãƒã‚°ä¿®æ­£**: æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®å†ç”Ÿãƒœã‚¿ãƒ³ãŒå‹•ä½œã—ãªã„å•é¡Œã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«å•é¡Œã€ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å•é¡Œã‚’ä¿®æ­£ã€‚
  - å•é¡Œ1: lambdaã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®é…å»¶è©•ä¾¡ã«ã‚ˆã‚Šã€å…¨ã¦ã®ãƒœã‚¿ãƒ³ãŒæœ€å¾Œã®videoã‚’å‚ç…§ã—ã¦ã„ãŸ â†’ ãƒã‚¹ãƒˆã—ãŸé–¢æ•°ã§è§£æ±º
  - å•é¡Œ2: å†ç”Ÿãƒ»åˆ¤å®šã§st.rerun()ãŒå‘¼ã°ã‚Œã€sample_idsãŒå†ç”Ÿæˆã•ã‚Œã¦ã„ãŸ â†’ shuffle_tokenã§åˆ¶å¾¡
  - å•é¡Œ3: CSSã‚»ãƒ¬ã‚¯ã‚¿ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã¦ã„ãªã‹ã£ãŸ â†’ `:has()`ã‚»ãƒ¬ã‚¯ã‚¿ã§è¦ªè¦ç´ ã‚’ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- **å®Ÿè£…è¨ˆç”»æ›¸ã¨ã®ç…§åˆç¢ºèªå®Œäº†** (2026-01-16 00:20)
- **2026-01-16 ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³æ”¹ä¿®**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã«ã‚ˆã‚Šå‰å›PRã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ã«å¤‰æ›´ (2026-01-16 00:30)
  - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´: ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¸Šï¼‰+ ãƒœã‚¿ãƒ³ãƒ»åˆ¤å®šUIãƒ»ãƒãƒƒã‚¸ï¼ˆæ¨ªä¸¦ã³ï¼‰
  - ãƒœã‚¿ãƒ³ã‚’çµµæ–‡å­—ã«å¤‰æ›´: â–¶ï¸ å†ç”Ÿã€âœ“ åˆ¤å®š
  - ã‚«ãƒ©ãƒ é…åˆ†: [2, 2, 4, 8] ã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆé…ç½®
  - é¸æŠä¸­ã‚«ãƒ¼ãƒ‰å¼·èª¿: `:has(.cb-selected)`ã§èƒŒæ™¯è‰²ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰+æ ç·šï¼ˆ3px solid #f59e0bï¼‰+å½±
  - æœªåˆ¤å®šãƒãƒƒã‚¸è¿½åŠ : ãƒ¬ãƒ™ãƒ«-1ã®å ´åˆã«ãƒ”ãƒ³ã‚¯è‰²ã®ã€Œæœªåˆ¤å®šã€ãƒãƒƒã‚¸ã‚’è¡¨ç¤º
  - ãƒ•ã‚¡ã‚¤ãƒ«: `ui/components/video_card.py` å…¨é¢æ›¸ãæ›ãˆ
- **2026-01-16 UIæ”¹å–„å®Ÿè£…** (2026-01-16 01:00)
  - âœ… ã‚«ãƒ©ãƒ æ•°ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³åŒ–ï¼ˆ3,4,5,6ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5ï¼‰
  - âœ… æœªåˆ¤å®šãƒ•ã‚£ãƒ«ã‚¿ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³è¿½åŠ ï¼ˆã™ã¹ã¦è¡¨ç¤º/æœªåˆ¤å®šã®ã¿ï¼‰
  - âœ… ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢ãƒ©ãƒ™ãƒ«ç°¡æ½”åŒ–ï¼ˆ"ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢"ï¼‰
  - âœ… UIè¦ç´ ã‚’æ¨ªä¸¦ã³é…ç½®ï¼ˆå‹•ç”»ä¸€è¦§4åˆ—ã€æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ 3åˆ—ï¼‰
  - âœ… ã‚«ãƒ¼ãƒ‰ã®ä¸Šä¸‹æƒãˆå®Ÿè£…ï¼ˆè¡Œã”ã¨ã«ã‚«ãƒ©ãƒ ä½œæˆï¼‰
  - âš ï¸ **æœªè§£æ±ºèª²é¡Œ**: é¸æŠä¸­ã‚«ãƒ¼ãƒ‰å¼·èª¿è¡¨ç¤ºãŒå®Ÿéš›ã«ã¯å‹•ä½œã—ã¦ã„ãªã„
    - CSSå®Ÿè£…æ¸ˆã¿ï¼ˆ`:has(.cb-selected)`ï¼‰ã ãŒè¦–è¦šçš„ã«ç¢ºèªã§ããš
    - åŸå› èª¿æŸ»ã¨ä¿®æ­£ãŒå¿…è¦ï¼ˆStreamlitã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é †åºã‚„CSSã®å„ªå…ˆé †ä½ã®å•é¡Œã®å¯èƒ½æ€§ï¼‰

## ğŸ“‹ å®Ÿè£…çŠ¶æ³ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º1: DBã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ âœ… å®Œäº†
- âœ… `judgment_history`ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆcore/database.py:88-142ï¼‰
- âœ… `core/migration.py`å®Ÿè£…ï¼ˆMigration ã‚¯ãƒ©ã‚¹ã€migrate_level_0_to_minus_1ï¼‰
- âœ… `extract_essential_filename()`ä¿®æ­£ï¼ˆcore/scanner.py:14-36ï¼‰
  - âœ… `?_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ â†’ ãƒ¬ãƒ™ãƒ«-1
  - âœ… ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã— â†’ ãƒ¬ãƒ™ãƒ«-1
  - âœ… `_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ â†’ ãƒ¬ãƒ™ãƒ«0
  - âœ… `#_`, `##_`, `###_`, `####_` â†’ ãƒ¬ãƒ™ãƒ«1-4
- âœ… streamlit_app.py ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆcheck_and_init_databaseï¼‰
- âœ… ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆtests/test_migration.py, tests/test_scanner.pyï¼‰
- âœ… å…¨ãƒ†ã‚¹ãƒˆPassï¼ˆ15ä»¶ã€python -m pytestï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º2: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±é€šåŒ– âœ… å®Œäº†
- âœ… ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
  - âœ… `ui/components/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
  - âœ… `ui/components/__init__.py`
- âœ… KPIè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆui/components/kpi_display.pyï¼‰
  - âœ… `render_kpi_cards()` å®Ÿè£…
  - âœ… `get_kpi_stats()` å®Ÿè£…
  - âœ… 4ã¤ã®KPIï¼ˆæœªåˆ¤å®šã€åˆ¤å®šæ¸ˆã¿ã€åˆ¤å®šç‡ã€æœ¬æ—¥ã®åˆ¤å®šï¼‰
- âœ… è¡¨ç¤ºè¨­å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆui/components/display_settings.pyï¼‰
  - âœ… `DisplaySettings` dataclass
  - âœ… `render_display_settings()` å®Ÿè£…
  - âœ… key_prefixå¯¾å¿œã§ã‚­ãƒ¼é‡è¤‡å›é¿
- âœ… å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆui/components/video_card.pyï¼‰
  - âœ… `render_video_card()` å®Ÿè£…
  - âœ… ãƒ¬ãƒ™ãƒ«ãƒãƒƒã‚¸ã€åˆ©ç”¨å¯å¦ãƒãƒƒã‚¸
  - âœ… å†ç”Ÿãƒœã‚¿ãƒ³ã€åˆ¤å®šUIï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³+åˆ¤å®šãƒœã‚¿ãƒ³ï¼‰
  - âœ… ãƒ¬ãƒ™ãƒ«-1å¯¾å¿œï¼ˆ"æœªåˆ¤å®š"è¡¨ç¤ºï¼‰
  - âœ… é¸æŠä¸­ã‚«ãƒ¼ãƒ‰å¼·èª¿ï¼ˆ:has()ã‚»ãƒ¬ã‚¯ã‚¿ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º3: KPIè¡¨ç¤ºã®å®Ÿè£… âœ… å®Œäº†
- âœ… å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã«KPIè¿½åŠ ï¼ˆui/library_tab.py:50-58ï¼‰
- âœ… æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã«KPIè¿½åŠ ï¼ˆui/unrated_random_tab.py:43-50ï¼‰
- âœ… KPIçµ±è¨ˆãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹
  - âœ… æœªåˆ¤å®šæ•°: `current_favorite_level = -1 AND is_available = 1 AND is_deleted = 0`
  - âœ… åˆ¤å®šæ¸ˆã¿æ•°: `current_favorite_level >= 0 AND is_available = 1 AND is_deleted = 0`
  - âœ… åˆ¤å®šç‡: `(judged_count / total_count * 100)`
  - âœ… æœ¬æ—¥ã®åˆ¤å®šæ•°: `judgment_history` ã‹ã‚‰ `DATE(judged_at) = DATE('now', 'localtime')`

### ãƒ•ã‚§ãƒ¼ã‚º4: æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®å®Ÿè£… âœ… å®Œäº†
- âœ… `ui/unrated_random_tab.py` ä½œæˆ
- âœ… `render_unrated_random_tab()` å®Ÿè£…
- âœ… KPIè¡¨ç¤º
- âœ… ä»¶æ•°é¸æŠï¼ˆ10/20/30/50ï¼‰
- âœ… ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãƒœã‚¿ãƒ³
- âœ… æœªåˆ¤å®šå‹•ç”»æŠ½å‡ºï¼ˆãƒ¬ãƒ™ãƒ«-1ï¼‰
- âœ… å‹•ç”»ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- âœ… å†ç”Ÿãƒ»åˆ¤å®šã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆ**ä¿®æ­£æ¸ˆã¿: ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å•é¡Œè§£æ±º**ï¼‰
- âœ… ã‚·ãƒ£ãƒƒãƒ•ãƒ«åˆ¶å¾¡ï¼ˆ**ä¿®æ­£æ¸ˆã¿: shuffle_tokenã§ç®¡ç†**ï¼‰
- âœ… streamlit_app.py ã«ã‚¿ãƒ–è¿½åŠ 

### ãƒ•ã‚§ãƒ¼ã‚º5: åˆ†æã‚¿ãƒ–ã®æ‹¡å¼µ âœ… å®Œäº†
- âœ… åˆ¤å®šå‡¦ç†ã§å¿œç­”é€Ÿåº¦è¨˜éŒ²ï¼ˆcore/app_service.py or core/video_manager.pyï¼‰
  - âœ… `judged_at`è¨˜éŒ²
  - âœ… `rename_completed_at`è¨˜éŒ²
  - âœ… `rename_duration_ms`è¨ˆç®—
  - âœ… `judgment_history`ã«æŒ¿å…¥
- âœ… å¿œç­”é€Ÿåº¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ï¼ˆui/analysis_tab.pyï¼‰
  - âœ… Plotlyä½¿ç”¨
  - âœ… ä¿å­˜å ´æ‰€åˆ¥ã®è‰²åˆ†ã‘
  - âœ… çµ±è¨ˆæƒ…å ±ï¼ˆå¹³å‡ã€ä¸­å¤®å€¤ã€æœ€å¤§ã€æœ€å°ï¼‰
  - âœ… ãƒ‡ãƒ¼ã‚¿ãªã—æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆtests/test_video_manager.py:test_set_favorite_level_with_rename_logs_historyï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º6: UIæ”¹å–„ï¼ˆé¸æŠä¸­ã‚«ãƒ¼ãƒ‰å¼·èª¿ãªã©ï¼‰ âœ… å®Œäº†
- âœ… é¸æŠä¸­ã‚«ãƒ¼ãƒ‰ã®å¼·èª¿è¡¨ç¤ºï¼ˆ**ä¿®æ­£æ¸ˆã¿**ï¼‰
  - âœ… CSS `:has(.cb-selected)` ã‚»ãƒ¬ã‚¯ã‚¿ã§è¦ªè¦ç´ ã‚’ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
  - âœ… èƒŒæ™¯è‰²: `linear-gradient(180deg, #fff7ed 0%, #fff0d9 100%)`
  - âœ… æ ç·š: `border: 2px solid #f59e0b`
  - âœ… ã‚·ãƒ£ãƒ‰ã‚¦: `box-shadow: 0 8px 16px rgba(245,158,11,0.28)`
- âœ… `st.session_state.selected_video` ã§é¸æŠçŠ¶æ…‹ä¿æŒ
- âœ… å†ç”Ÿãƒ»åˆ¤å®šæ™‚ã«é¸æŠçŠ¶æ…‹æ›´æ–°

### æ©Ÿèƒ½ä¸€è¦§ãƒã‚§ãƒƒã‚¯ï¼ˆè¨ˆç”»æ›¸ 2ç« ï¼‰
| No. | æ©Ÿèƒ½å | çŠ¶æ…‹ | å‚™è€ƒ |
|-----|--------|------|------|
| 1 | ãƒ¬ãƒ™ãƒ«-1ï¼ˆæœªåˆ¤å®šï¼‰ã®å°å…¥ | âœ… | extract_essential_filenameä¿®æ­£æ¸ˆã¿ |
| 2 | KPIè¡¨ç¤ºã®è¿½åŠ  | âœ… | 4ã¤ã®KPIã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒª+æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã«è¡¨ç¤º |
| 3 | é¸æŠä¸­ã‚«ãƒ¼ãƒ‰ã®å¼·èª¿è¡¨ç¤º | âœ… | **ä¿®æ­£æ¸ˆã¿**: CSSã‚»ãƒ¬ã‚¯ã‚¿é©ç”¨ |
| 4 | æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®è¿½åŠ  | âœ… | **ä¿®æ­£æ¸ˆã¿**: å†ç”Ÿãƒ»ã‚·ãƒ£ãƒƒãƒ•ãƒ«å•é¡Œè§£æ±º |
| 5 | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±é€šåŒ– | âœ… | ui/components/ ä½œæˆå®Œäº† |
| 6 | åˆ¤å®šå¾Œã®å¿œç­”é€Ÿåº¦åˆ†æ | âœ… | judgment_historyè¨˜éŒ²+Plotlyã‚°ãƒ©ãƒ• |
| 7 | æ—¢å­˜ãƒ¬ãƒ™ãƒ«0å‹•ç”»ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | 903ä»¶ã‚’-1ã«å¤‰æ›´ |
| 8 | ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‰±ã„ | âœ… | ãƒ¬ãƒ™ãƒ«-1ã¨ã—ã¦ç™»éŒ² |
| 9 | ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®è‡ªå‹•æ›´æ–° | âœ… | init_database()ã§å®Ÿè¡Œ |
| 10 | ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã¸ã®ãƒ¬ãƒ™ãƒ«-1è¿½åŠ  | âœ… | video_card.py: level_options = [-1, 0, 1, 2, 3, 4] |
| 11 | Plotlyã‚°ãƒ©ãƒ•ã¸ã®ç§»è¡Œ | âœ… | åˆ†æã‚¿ãƒ–å…¨ã¦PlotlyåŒ– |

### ãƒ†ã‚¹ãƒˆçµæœ
- âœ… å…¨15ä»¶Passï¼ˆpython -m pytestï¼‰
- âœ… è­¦å‘Š: sqlite datetime adapter deprecationï¼ˆPython 3.12+ï¼‰
- âš ï¸ éæ¨å¥¨è­¦å‘Š: `use_container_width` â†’ `width` (Streamlit 2026å¹´ä»¥é™)

### æ—¢çŸ¥ã®å•é¡Œã¨ä¿®æ­£å±¥æ­´
1. **æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®å†ç”Ÿãƒœã‚¿ãƒ³å•é¡Œ** âœ… ä¿®æ­£å®Œäº†
   - **åŸå› **: lambdaã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®é…å»¶è©•ä¾¡ã«ã‚ˆã‚Šã€å…¨ã¦ã®ãƒœã‚¿ãƒ³ãŒæœ€å¾Œã®videoã‚’å‚ç…§
   - **ä¿®æ­£**: ãƒã‚¹ãƒˆã—ãŸé–¢æ•° `make_play_handler()`, `make_judge_handler()` ã§æ­£ã—ãã‚­ãƒ£ãƒ—ãƒãƒ£
   - **ãƒ•ã‚¡ã‚¤ãƒ«**: ui/unrated_random_tab.py:136-145, ui/library_tab.py:116-125

2. **ã‚·ãƒ£ãƒƒãƒ•ãƒ«å•é¡Œ** âœ… ä¿®æ­£å®Œäº†
   - **åŸå› **: å†ç”Ÿãƒ»åˆ¤å®šã§st.rerun()ãŒå‘¼ã°ã‚Œã€sample_idsãŒæ¯å›å†ç”Ÿæˆ
   - **ä¿®æ­£**: `shuffle_token` ã¨ `prev_token` ã§åˆ¶å¾¡ã—ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ã¿å†ç”Ÿæˆ
   - **ãƒ•ã‚¡ã‚¤ãƒ«**: ui/unrated_random_tab.py:71-101

3. **ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å•é¡Œ** âœ… ä¿®æ­£å®Œäº†
   - **åŸå› **: CSSã‚¯ãƒ©ã‚¹ `.cb-card` ãŒé©ç”¨ã•ã‚Œã¦ã„ãŸãŒã€è¦ªè¦ç´ ã¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒåŠ¹ã„ã¦ã„ãªã‹ã£ãŸ
   - **ä¿®æ­£**: `:has(.cb-selected)` ã‚»ãƒ¬ã‚¯ã‚¿ã§è¦ªè¦ç´ ï¼ˆstVerticalBlockï¼‰ã‚’ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
   - **ãƒ•ã‚¡ã‚¤ãƒ«**: ui/components/video_card.py:26-32

### è¨ˆç”»æ›¸ã¨ã®ç›¸é•ç‚¹
- **ãªã—**: å…¨ã¦ã®æ©Ÿèƒ½ãŒè¨ˆç”»æ›¸é€šã‚Šã«å®Ÿè£…å®Œäº†

### ä»Šå¾Œã®ã‚¿ã‚¹ã‚¯
- [ ] Streamlitéæ¨å¥¨è­¦å‘Šã®è§£æ¶ˆï¼ˆ`use_container_width` â†’ `width`ï¼‰
- [ ] sqlite datetime adapterè­¦å‘Šã®è§£æ¶ˆï¼ˆPython 3.12+å¯¾å¿œï¼‰
- [ ] æœ€çµ‚UIç¢ºèªã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—

## ğŸ“‹ 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### èƒŒæ™¯

ClipBoxã¯ç´„3000æœ¬ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹Streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ç¾åœ¨ã€å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã€ãƒ©ãƒ³ãƒ€ãƒ ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚¿ãƒ–ã€è¦–è´å±¥æ­´ã‚¿ãƒ–ã€åˆ†æã‚¿ãƒ–ãŒå®Ÿè£…æ¸ˆã¿ã§ã™ã€‚ä»Šå›ã¯UIæ”¹å–„ã¨æ©Ÿèƒ½è¿½åŠ ã‚’è¡Œã†å¤§è¦æ¨¡ãªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’è¨ˆç”»ã—ã¦ã„ã¾ã™ã€‚

### ç›®çš„

- **åˆ¤å®šä½œæ¥­ã®åŠ¹ç‡åŒ–**: æœªåˆ¤å®šå‹•ç”»ã®ç®¡ç†æ©Ÿèƒ½ã‚’å°å…¥
- **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š**: é¸æŠä¸­ã‚«ãƒ¼ãƒ‰ã®è¦–è¦šçš„å¼·èª¿ã€KPIè¡¨ç¤º
- **ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±é€šåŒ–ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†é›¢
- **ãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½ã®æ‹¡å……**: å¿œç­”é€Ÿåº¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã€Plotlyã¸ã®ç§»è¡Œ

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: Python 3.9+
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Streamlit
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLite
- **ãƒ‡ãƒ¼ã‚¿å‡¦ç†**: pandas
- **å¯è¦–åŒ–**: Plotlyï¼ˆmatplotlib ã‹ã‚‰ç§»è¡Œäºˆå®šï¼‰

---

## ğŸ¯ 2. å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ã®ä¸€è¦§

| No. | æ©Ÿèƒ½å | æ¦‚è¦ | å„ªå…ˆåº¦ |
|-----|--------|------|--------|
| 1 | ãƒ¬ãƒ™ãƒ«-1ï¼ˆæœªåˆ¤å®šï¼‰ã®å°å…¥ | è² ã®å€¤ã‚’ä½¿ã£ãŸæœªåˆ¤å®šå‹•ç”»ã®ç®¡ç† | é«˜ |
| 2 | KPIè¡¨ç¤ºã®è¿½åŠ  | æœªåˆ¤å®šæ•°ã€åˆ¤å®šæ•°ã€åˆ¤å®šç‡ã€æœ¬æ—¥ã®åˆ¤å®šæ•°ã‚’è¡¨ç¤º | é«˜ |
| 3 | é¸æŠä¸­ã‚«ãƒ¼ãƒ‰ã®å¼·èª¿è¡¨ç¤º | èƒŒæ™¯è‰²+æ ç·šã§é¸æŠä¸­ã®ã‚«ãƒ¼ãƒ‰ã‚’å¼·èª¿ | é«˜ |
| 4 | æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®è¿½åŠ  | æœªåˆ¤å®šå‹•ç”»ã‚’ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡ºã—ã¦è¡¨ç¤º | é«˜ |
| 5 | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±é€šåŒ– | KPIã€å‹•ç”»ã‚«ãƒ¼ãƒ‰ã€è¡¨ç¤ºè¨­å®šã‚’å…±é€šåŒ– | é«˜ |
| 6 | åˆ¤å®šå¾Œã®å¿œç­”é€Ÿåº¦åˆ†æ | åˆ¤å®šãƒœã‚¿ãƒ³æŠ¼ä¸‹ã‹ã‚‰ãƒªãƒãƒ¼ãƒ å®Œäº†ã¾ã§ã®æ™‚é–“ã‚’è¨˜éŒ²ãƒ»åˆ†æ | ä¸­ |
| 7 | æ—¢å­˜ãƒ¬ãƒ™ãƒ«0å‹•ç”»ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§åˆ¤åˆ¥ã—ã¦-1ã«å¤‰æ›´ | é«˜ |
| 8 | ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‰±ã„ | ãƒ¬ãƒ™ãƒ«-1ã¨ã—ã¦ç™»éŒ² | é«˜ |
| 9 | ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®è‡ªå‹•æ›´æ–° | is_availableãƒ•ãƒ©ã‚°ã‚’è‡ªå‹•æ›´æ–° | ä¸­ |
| 10 | ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã¸ã®ãƒ¬ãƒ™ãƒ«-1è¿½åŠ  | åˆ¤å®šUIã«-1ã‚’è¿½åŠ  | é«˜ |
| 11 | Plotlyã‚°ãƒ©ãƒ•ã¸ã®ç§»è¡Œ | åˆ†æã‚¿ãƒ–ã‚’matplotlibã‹ã‚‰Plotlyã«ç§»è¡Œ | ä½ |

---

## ğŸ—„ï¸ 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´

### 3.1 videosãƒ†ãƒ¼ãƒ–ãƒ«

**å¤‰æ›´ãªã—**

ç¾åœ¨ã®`videos`ãƒ†ãƒ¼ãƒ–ãƒ«ã®`current_favorite_level`ã‚«ãƒ©ãƒ ã¯æ—¢ã«INTEGERå‹ã®ãŸã‚ã€è² ã®å€¤ã‚‚æ ¼ç´å¯èƒ½ã§ã™ã€‚æ—¢å­˜ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¾ã™ã€‚

```sql
-- æ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒï¼ˆå¤‰æ›´ãªã—ï¼‰
CREATE TABLE videos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    essential_filename TEXT UNIQUE NOT NULL,
    current_full_path TEXT NOT NULL,
    current_favorite_level INTEGER DEFAULT 0,
    file_size INTEGER,
    performer TEXT,
    storage_location TEXT,
    last_file_modified DATETIME,
    file_created_at DATETIME,
    is_available INTEGER DEFAULT 1,
    is_deleted INTEGER DEFAULT 0,
    last_scanned_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 3.2 judgment_historyãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ

**æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«**

åˆ¤å®šå±¥æ­´ã¨å¿œç­”é€Ÿåº¦ã‚’è¨˜éŒ²ã™ã‚‹ãŸã‚ã®æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```sql
CREATE TABLE IF NOT EXISTS judgment_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    video_id INTEGER NOT NULL,
    old_level INTEGER,                    -- å¤‰æ›´å‰ã®ãƒ¬ãƒ™ãƒ«ï¼ˆNULL=æ–°è¦åˆ¤å®šï¼‰
    new_level INTEGER NOT NULL,           -- å¤‰æ›´å¾Œã®ãƒ¬ãƒ™ãƒ«
    judged_at DATETIME NOT NULL,          -- åˆ¤å®šãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚åˆ»
    rename_completed_at DATETIME,         -- ãƒªãƒãƒ¼ãƒ å®Œäº†æ™‚åˆ»
    rename_duration_ms INTEGER,           -- å¿œç­”é€Ÿåº¦ï¼ˆãƒŸãƒªç§’ï¼‰
    storage_location TEXT,                -- ä¿å­˜å ´æ‰€ï¼ˆåˆ†æç”¨ï¼‰
    FOREIGN KEY (video_id) REFERENCES videos(id) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_judged_at ON judgment_history(judged_at);
CREATE INDEX IF NOT EXISTS idx_video_id ON judgment_history(video_id);
```

**ã‚«ãƒ©ãƒ èª¬æ˜**:
- `video_id`: å¯¾è±¡å‹•ç”»ã®ID
- `old_level`: åˆ¤å®šå‰ã®ãƒ¬ãƒ™ãƒ«ï¼ˆNULLã®å ´åˆã¯æ–°è¦åˆ¤å®šï¼‰
- `new_level`: åˆ¤å®šå¾Œã®ãƒ¬ãƒ™ãƒ«
- `judged_at`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ¤å®šãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚åˆ»
- `rename_completed_at`: ãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒãƒ¼ãƒ ãŒå®Œäº†ã—ãŸæ™‚åˆ»
- `rename_duration_ms`: åˆ¤å®šã‹ã‚‰å®Œäº†ã¾ã§ã®æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
- `storage_location`: ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å ´æ‰€ï¼ˆC_DRIVE / EXTERNAL_HDDï¼‰

### 3.3 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQL

**ç›®çš„**: æ—¢å­˜ã®ãƒ¬ãƒ™ãƒ«0å‹•ç”»ã®ã†ã¡ã€ãƒ•ã‚¡ã‚¤ãƒ«åã«ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãªã„ã‚‚ã®ã‚’-1ã«å¤‰æ›´ã™ã‚‹

**å®Ÿè£…æ–¹é‡**:
- SQLiteã§ã¯REVERSEé–¢æ•°ãŒãªã„ãŸã‚ã€Pythonã‚³ãƒ¼ãƒ‰ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‹ã‚‰å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ã—ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯
- ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ï¼ˆ`_`ã‚„`#`ã§å§‹ã¾ã‚‰ãªã„ï¼‰ã®ãƒ¬ãƒ™ãƒ«0å‹•ç”»ã‚’-1ã«å¤‰æ›´

**Pythonã«ã‚ˆã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**:
```python
# core/migration.py ã§å®Ÿè£…ï¼ˆè©³ç´°ã¯å¾Œè¿°ï¼‰
def migrate_level_0_to_minus_1(conn):
    cursor = conn.execute("""
        SELECT id, current_full_path, essential_filename
        FROM videos
        WHERE current_favorite_level = 0
    """)
    videos = cursor.fetchall()

    updated_count = 0
    for video_id, full_path, essential_filename in videos:
        filename = Path(full_path).name

        # ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯
        if not filename.startswith('_') and not filename.startswith('#'):
            conn.execute("""
                UPDATE videos
                SET current_favorite_level = -1
                WHERE id = ?
            """, (video_id,))
            updated_count += 1

    return updated_count
```

---

## ğŸ“Š 4. å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã¨ä¾å­˜é–¢ä¿‚

### ãƒ•ã‚§ãƒ¼ã‚ºã®å…¨ä½“åƒ

```
ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆå¿…é ˆãƒ»åŸºç›¤ï¼‰
  â†“
ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆå¿…é ˆãƒ»åŸºç›¤ï¼‰
  â†“
ãƒ•ã‚§ãƒ¼ã‚º3 â†â”€â”
  â†“        â”‚
ãƒ•ã‚§ãƒ¼ã‚º4 â†â”€â”¤ï¼ˆãƒ•ã‚§ãƒ¼ã‚º3ã¨ãƒ•ã‚§ãƒ¼ã‚º4ã¯ä¸¦è¡Œå¯èƒ½ï¼‰
  â†“        â”‚
ãƒ•ã‚§ãƒ¼ã‚º5 â†â”€â”˜
  â†“
ãƒ•ã‚§ãƒ¼ã‚º6
```

### å„ãƒ•ã‚§ãƒ¼ã‚ºã®æ¦‚è¦

| ãƒ•ã‚§ãƒ¼ã‚º | åç§° | æ‰€è¦æ™‚é–“è¦‹ç©ã‚‚ã‚Š | ä¾å­˜é–¢ä¿‚ |
|----------|------|------------------|----------|
| ãƒ•ã‚§ãƒ¼ã‚º1 | DBã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | 2-3æ™‚é–“ | ãªã— |
| ãƒ•ã‚§ãƒ¼ã‚º2 | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±é€šåŒ– | 4-6æ™‚é–“ | ãƒ•ã‚§ãƒ¼ã‚º1 |
| ãƒ•ã‚§ãƒ¼ã‚º3 | KPIè¡¨ç¤ºã®å®Ÿè£… | 3-4æ™‚é–“ | ãƒ•ã‚§ãƒ¼ã‚º2 |
| ãƒ•ã‚§ãƒ¼ã‚º4 | æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®å®Ÿè£… | 3-4æ™‚é–“ | ãƒ•ã‚§ãƒ¼ã‚º2 |
| ãƒ•ã‚§ãƒ¼ã‚º5 | åˆ†æã‚¿ãƒ–ã®æ‹¡å¼µ | 2-3æ™‚é–“ | ãƒ•ã‚§ãƒ¼ã‚º1 |
| ãƒ•ã‚§ãƒ¼ã‚º6 | UIæ”¹å–„ï¼ˆé¸æŠä¸­ã‚«ãƒ¼ãƒ‰å¼·èª¿ãªã©ï¼‰ | 2-3æ™‚é–“ | ãƒ•ã‚§ãƒ¼ã‚º2 |

**åˆè¨ˆæ‰€è¦æ™‚é–“**: 16-23æ™‚é–“

---

## ğŸ¯ 5. ãƒ•ã‚§ãƒ¼ã‚º1: DBã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### 5.1 ç›®çš„

- ãƒ¬ãƒ™ãƒ«-1ï¼ˆæœªåˆ¤å®šï¼‰ã‚’å°å…¥ã™ã‚‹ãŸã‚ã®åŸºç›¤æ•´å‚™
- åˆ¤å®šå¾Œã®å¿œç­”é€Ÿåº¦ã‚’è¨˜éŒ²ã™ã‚‹ãŸã‚ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### 5.2 å®Ÿè£…å†…å®¹

#### 5.2.1 judgment_historyãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `core/database.py`

**å®Ÿè£…**:
```python
def init_database():
    """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«è¿½åŠ ï¼‰"""
    with get_db_connection() as conn:
        # ... æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆå‡¦ç† ...

        # judgment_historyãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
        conn.execute("""
            CREATE TABLE IF NOT EXISTS judgment_history (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                video_id INTEGER NOT NULL,
                old_level INTEGER,
                new_level INTEGER NOT NULL,
                judged_at DATETIME NOT NULL,
                rename_completed_at DATETIME,
                rename_duration_ms INTEGER,
                storage_location TEXT,
                FOREIGN KEY (video_id) REFERENCES videos(id) ON DELETE CASCADE
            )
        """)

        conn.execute("CREATE INDEX IF NOT EXISTS idx_judged_at ON judgment_history(judged_at)")
        conn.execute("CREATE INDEX IF NOT EXISTS idx_video_id ON judgment_history(video_id)")
```

#### 5.2.2 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `core/migration.py`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…**:
```python
"""
ClipBox - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
"""

import sqlite3
from datetime import datetime
from pathlib import Path


class Migration:
    """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚¯ãƒ©ã‚¹"""

    def __init__(self, db_path: Path):
        """
        Args:
            db_path: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
        """
        self.db_path = db_path
        self.migration_log_path = db_path.parent / "migration_history.txt"

    def is_migration_completed(self, migration_id: str) -> bool:
        """
        ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯

        Args:
            migration_id: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­

        Returns:
            bool: å®Œäº†æ¸ˆã¿ãªã‚‰True
        """
        if not self.migration_log_path.exists():
            return False

        with open(self.migration_log_path, 'r', encoding='utf-8') as f:
            return migration_id in f.read()

    def mark_migration_completed(self, migration_id: str):
        """
        ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ã‚’ãƒãƒ¼ã‚¯

        Args:
            migration_id: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­
        """
        with open(self.migration_log_path, 'a', encoding='utf-8') as f:
            f.write(f"{migration_id}\t{datetime.now().isoformat()}\n")

    def migrate_level_0_to_minus_1(self, conn: sqlite3.Connection) -> dict:
        """
        ãƒ¬ãƒ™ãƒ«0å‹•ç”»ã®ã†ã¡ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ã‚’-1ã«å¤‰æ›´

        Args:
            conn: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š

        Returns:
            dict: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ
                - status: 'completed' | 'skipped'
                - message: çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                - updated_count: æ›´æ–°ä»¶æ•°
        """
        migration_id = "migrate_level_0_to_minus_1_20260115"

        if self.is_migration_completed(migration_id):
            return {
                "status": "skipped",
                "message": "ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ—¢ã«å®Œäº†ã—ã¦ã„ã¾ã™",
                "updated_count": 0
            }

        # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
        cursor = conn.execute("""
            SELECT id, current_full_path, essential_filename
            FROM videos
            WHERE current_favorite_level = 0
        """)
        videos = cursor.fetchall()

        updated_count = 0
        for video_id, full_path, essential_filename in videos:
            # ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ï¼ˆãƒ‘ã‚¹ã®æœ€å¾Œã®éƒ¨åˆ†ï¼‰
            filename = Path(full_path).name

            # ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯
            # `_`ã‚„`#`ã§å§‹ã¾ã‚‰ãªã„å ´åˆã¯æœªåˆ¤å®šã¨ã¿ãªã™
            if not filename.startswith('_') and not filename.startswith('#'):
                conn.execute("""
                    UPDATE videos
                    SET current_favorite_level = -1
                    WHERE id = ?
                """, (video_id,))
                updated_count += 1

        conn.commit()
        self.mark_migration_completed(migration_id)

        return {
            "status": "completed",
            "message": f"{updated_count} ä»¶ã®å‹•ç”»ã‚’ãƒ¬ãƒ™ãƒ«0ã‹ã‚‰ãƒ¬ãƒ™ãƒ«-1ã«å¤‰æ›´ã—ã¾ã—ãŸ",
            "updated_count": updated_count
        }
```

#### 5.2.3 extract_essential_filename()ã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `core/scanner.py`

**ç¾åœ¨ã®å®Ÿè£…**:
```python
def extract_essential_filename(filename: str) -> Tuple[int, str]:
    """
    ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒ™ãƒ«ã¨æœ¬è³ªçš„ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŠ½å‡º

    ç¾åœ¨ã®å‹•ä½œ:
    - "###_ä½œå“å.mp4" -> (3, "ä½œå“å.mp4")
    - "_ä½œå“å.mp4" -> (0, "ä½œå“å.mp4")
    - "ä½œå“å.mp4" -> (0, "ä½œå“å.mp4")  # ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—
    """
    match = re.match(r'^(#{0,})_(.+)$', filename)

    if match:
        prefix = match.group(1)
        essential = match.group(2)
        level = len(prefix)
        return level, essential
    else:
        return 0, filename
```

**ä¿®æ­£å¾Œã®å®Ÿè£…**:
```python
def extract_essential_filename(filename: str) -> Tuple[int, str]:
    """
    ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒ™ãƒ«ã¨æœ¬è³ªçš„ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŠ½å‡º

    æ–°ã—ã„å‹•ä½œ:
    - "####_ä½œå“å.mp4" -> (4, "ä½œå“å.mp4")
    - "###_ä½œå“å.mp4" -> (3, "ä½œå“å.mp4")
    - "##_ä½œå“å.mp4" -> (2, "ä½œå“å.mp4")
    - "#_ä½œå“å.mp4" -> (1, "ä½œå“å.mp4")
    - "_ä½œå“å.mp4" -> (0, "ä½œå“å.mp4")
    - "?_ä½œå“å.mp4" -> (-1, "ä½œå“å.mp4")  # æ˜ç¤ºçš„ãªæœªåˆ¤å®š
    - "ä½œå“å.mp4" -> (-1, "ä½œå“å.mp4")  # ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—=æœªåˆ¤å®š

    Args:
        filename: å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«å

    Returns:
        (favorite_level, essential_filename) ã®ã‚¿ãƒ—ãƒ«
    """
    # ãƒ‘ã‚¿ãƒ¼ãƒ³1: ?_ã§å§‹ã¾ã‚‹å ´åˆã¯æ˜ç¤ºçš„ãªæœªåˆ¤å®šï¼ˆãƒ¬ãƒ™ãƒ«-1ï¼‰
    if filename.startswith('?_'):
        essential = filename[2:]  # '?_'ã‚’é™¤å»
        return -1, essential

    # ãƒ‘ã‚¿ãƒ¼ãƒ³2: #ã®å€‹æ•°ã§ãƒ¬ãƒ™ãƒ«ã‚’åˆ¤å®š
    match = re.match(r'^(#{0,})_(.+)$', filename)

    if match:
        prefix = match.group(1)
        essential = match.group(2)
        level = len(prefix)  # #ã®å€‹æ•° = ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒ™ãƒ«
        return level, essential
    else:
        # ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãªã„å ´åˆã¯æœªåˆ¤å®šï¼ˆãƒ¬ãƒ™ãƒ«-1ï¼‰
        return -1, filename
```

#### 5.2.4 ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `streamlit_app.py`

**å®Ÿè£…**:
```python
from core.migration import Migration
from config import DATABASE_PATH

def check_and_init_database():
    """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèªã¨åˆæœŸåŒ–ï¼ˆæ—¢å­˜é–¢æ•°ã‚’æ‹¡å¼µï¼‰"""
    # æ—¢å­˜ã®DBåˆæœŸåŒ–å‡¦ç†
    app_service.init_database()

    if not app_service.check_database_exists():
        st.error(f"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {DATABASE_PATH}")
        st.info("ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:")
        st.code("python archive/setup_db.py", language="bash")
        st.stop()

    # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    migration = Migration(DATABASE_PATH)

    with app_service.get_db_connection() as conn:
        result = migration.migrate_level_0_to_minus_1(conn)

        if result["status"] == "completed" and result["updated_count"] > 0:
            st.info(f"âœ… {result['message']}")
```

### 5.3 ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] judgment_historyãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ­£ã—ãä½œæˆã•ã‚Œã‚‹
- [ ] `extract_essential_filename()`ãŒ`?_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ãƒ¬ãƒ™ãƒ«-1ã¨ã—ã¦èªè­˜
- [ ] `extract_essential_filename()`ãŒãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ã‚’ãƒ¬ãƒ™ãƒ«-1ã¨ã—ã¦èªè­˜
- [ ] ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ã®ãƒ¬ãƒ™ãƒ«0å‹•ç”»ãŒ-1ã«å¤‰æ›´ã•ã‚Œã‚‹
- [ ] `_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãã®ãƒ¬ãƒ™ãƒ«0å‹•ç”»ã¯0ã®ã¾ã¾ç¶­æŒã•ã‚Œã‚‹
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒ2å›å®Ÿè¡Œã•ã‚Œã¦ã‚‚ã€2å›ç›®ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœãŒãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹

### 5.4 æ³¨æ„äº‹é …

- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¨å¥¨**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå‰ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ¨å¥¨
- **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã¯æœªå®Ÿè£…ï¼ˆæ‰‹å‹•ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒï¼‰
- **ãƒ‘ã‚¹äº’æ›æ€§**: Windows/Linux/Macã§ãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ãŒç•°ãªã‚‹ãŸã‚ã€`Path`ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨

---

## ğŸ¯ 6. ãƒ•ã‚§ãƒ¼ã‚º2: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±é€šåŒ–

### 6.1 ç›®çš„

- UIå±¤ã®ã‚³ãƒ¼ãƒ‰ã‚’æ•´ç†ã—ã€å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŠ½å‡º
- å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã¨æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã§åŒã˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨
- ä¿å®ˆæ€§ã¨ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š

### 6.2 ææ¡ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
project_root/
â”œâ”€â”€ streamlit_app.py                # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼ˆã‚¿ãƒ–æŒ¯ã‚Šåˆ†ã‘ã®ã¿ï¼‰
â”œâ”€â”€ core/                           # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”œâ”€â”€ database.py
â”‚   â”œâ”€â”€ file_ops.py
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ video_manager.py
â”‚   â”œâ”€â”€ migration.py                # â˜…NEWâ˜…
â”‚   â”œâ”€â”€ scanner.py
â”‚   â”œâ”€â”€ counter_service.py
â”‚   â”œâ”€â”€ snapshot.py
â”‚   â”œâ”€â”€ analysis_service.py
â”‚   â”œâ”€â”€ app_service.py
â”‚   â”œâ”€â”€ config_utils.py
â”‚   â”œâ”€â”€ config_store.py
â”‚   â”œâ”€â”€ history_repository.py
â”‚   â””â”€â”€ settings.py
â”œâ”€â”€ ui/                             # UIå±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ components/                 # å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â˜…NEWâ˜…
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ kpi_display.py         # KPIè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ video_card.py          # å‹•ç”»ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ display_settings.py    # è¡¨ç¤ºè¨­å®šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ filters.py             # ãƒ•ã‚£ãƒ«ã‚¿UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ library_tab.py              # å‹•ç”»ä¸€è¦§ã‚¿ãƒ–
â”‚   â”œâ”€â”€ unrated_random_tab.py       # æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ– â˜…NEWâ˜…
â”‚   â”œâ”€â”€ analysis_tab.py             # åˆ†æã‚¿ãƒ–
â”‚   â””â”€â”€ extra_tabs.py               # ãã®ä»–ã®ã‚¿ãƒ–
â””â”€â”€ data/
    â””â”€â”€ videos.db
```

### 6.3 å®Ÿè£…å†…å®¹

#### 6.3.1 KPIè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `ui/components/kpi_display.py`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…**:
```python
"""
ClipBox - KPIè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
"""

import streamlit as st
from datetime import datetime


def render_kpi_cards(
    unrated_count: int,
    judged_count: int,
    judged_rate: float,
    today_judged_count: int
):
    """
    KPIã‚«ãƒ¼ãƒ‰ã‚’4ã¤æ¨ªä¸¦ã³ã§è¡¨ç¤º

    Args:
        unrated_count: æœªåˆ¤å®šå‹•ç”»æ•°
        judged_count: åˆ¤å®šæ¸ˆã¿å‹•ç”»æ•°
        judged_rate: åˆ¤å®šç‡ï¼ˆ%ï¼‰
        today_judged_count: æœ¬æ—¥ã®åˆ¤å®šæ•°
    """
    cols = st.columns(4)

    with cols[0]:
        st.metric(
            label="ğŸ“‹ æœªåˆ¤å®š",
            value=f"{unrated_count}æœ¬",
            help="ãƒ¬ãƒ™ãƒ«-1ã‹ã¤åˆ©ç”¨å¯èƒ½ã‹ã¤æœªå‰Šé™¤ã®å‹•ç”»æ•°"
        )

    with cols[1]:
        st.metric(
            label="âœ… åˆ¤å®šæ¸ˆã¿",
            value=f"{judged_count}æœ¬",
            help="åˆ¤å®šæ¸ˆã¿å‹•ç”»æ•°ï¼ˆãƒ¬ãƒ™ãƒ«0ä»¥ä¸Šï¼‰"
        )

    with cols[2]:
        st.metric(
            label="ğŸ“Š åˆ¤å®šç‡",
            value=f"{judged_rate:.1f}%",
            help="åˆ©ç”¨å¯èƒ½ã‹ã¤æœªå‰Šé™¤ã®å‹•ç”»ã®ã†ã¡ã€åˆ¤å®šæ¸ˆã¿ã®å‰²åˆ"
        )

    with cols[3]:
        st.metric(
            label="ğŸ“… æœ¬æ—¥ã®åˆ¤å®š",
            value=f"{today_judged_count}æœ¬",
            help="ä»Šæ—¥0:00ä»¥é™ã«åˆ¤å®šã—ãŸå‹•ç”»æ•°ï¼ˆé‡è¤‡æ’é™¤ï¼‰"
        )


def get_kpi_stats(conn) -> dict:
    """
    KPIçµ±è¨ˆã‚’å–å¾—

    Args:
        conn: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š

    Returns:
        dict: KPIçµ±è¨ˆ
            - unrated_count: æœªåˆ¤å®šå‹•ç”»æ•°
            - judged_count: åˆ¤å®šæ¸ˆã¿å‹•ç”»æ•°
            - judged_rate: åˆ¤å®šç‡ï¼ˆ%ï¼‰
            - today_judged_count: æœ¬æ—¥ã®åˆ¤å®šæ•°
    """
    # æœªåˆ¤å®šæ•°ï¼ˆãƒ¬ãƒ™ãƒ«-1ã€åˆ©ç”¨å¯èƒ½ã€æœªå‰Šé™¤ï¼‰
    cursor = conn.execute("""
        SELECT COUNT(*)
        FROM videos
        WHERE current_favorite_level = -1
          AND is_available = 1
          AND is_deleted = 0
    """)
    unrated_count = cursor.fetchone()[0]

    # åˆ¤å®šæ¸ˆã¿æ•°ï¼ˆãƒ¬ãƒ™ãƒ«0ä»¥ä¸Šã€åˆ©ç”¨å¯èƒ½ã€æœªå‰Šé™¤ï¼‰
    cursor = conn.execute("""
        SELECT COUNT(*)
        FROM videos
        WHERE current_favorite_level >= 0
          AND is_available = 1
          AND is_deleted = 0
    """)
    judged_count = cursor.fetchone()[0]

    # åˆ¤å®šç‡
    total_count = unrated_count + judged_count
    judged_rate = (judged_count / total_count * 100) if total_count > 0 else 0

    # æœ¬æ—¥ã®åˆ¤å®šæ•°ï¼ˆjudgment_historyãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—ï¼‰
    try:
        cursor = conn.execute("""
            SELECT COUNT(DISTINCT video_id)
            FROM judgment_history
            WHERE DATE(judged_at) = DATE('now', 'localtime')
        """)
        today_judged_count = cursor.fetchone()[0]
    except:
        # judgment_historyãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯0
        today_judged_count = 0

    return {
        'unrated_count': unrated_count,
        'judged_count': judged_count,
        'judged_rate': judged_rate,
        'today_judged_count': today_judged_count
    }
```

#### 6.3.2 è¡¨ç¤ºè¨­å®šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `ui/components/display_settings.py`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…**:
```python
"""
ClipBox - è¡¨ç¤ºè¨­å®šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
"""

import streamlit as st
from dataclasses import dataclass


@dataclass
class DisplaySettings:
    """è¡¨ç¤ºè¨­å®šã®çŠ¶æ…‹ã‚’ä¿æŒ"""
    show_level_badge: bool = True
    show_availability_badge: bool = True
    show_view_count_badge: bool = False
    show_storage_badge: bool = False
    show_filesize_badge: bool = False
    show_modified_badge: bool = False
    show_filename_badge: bool = False
    max_title_length: int = 40
    num_columns: int = 3


def render_display_settings() -> DisplaySettings:
    """
    è¡¨ç¤ºè¨­å®šUIã‚’æç”»ã—ã€è¨­å®šå€¤ã‚’è¿”ã™

    Returns:
        DisplaySettings: ç¾åœ¨ã®è¡¨ç¤ºè¨­å®š
    """
    with st.expander("ğŸ¨ è¡¨ç¤ºè¨­å®š", expanded=False):
        col1, col2 = st.columns(2)

        with col1:
            st.write("**ãƒãƒƒã‚¸è¡¨ç¤º**")
            show_level = st.checkbox("ãƒ¬ãƒ™ãƒ«", value=True, key="disp_level")
            show_avail = st.checkbox("åˆ©ç”¨å¯å¦", value=True, key="disp_avail")
            show_views = st.checkbox("è¦–è´å›æ•°", value=False, key="disp_views")
            show_storage = st.checkbox("ä¿å­˜å ´æ‰€", value=False, key="disp_storage")
            show_filesize = st.checkbox("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º", value=False, key="disp_filesize")
            show_modified = st.checkbox("æ›´æ–°æ—¥æ™‚", value=False, key="disp_modified")
            show_filename = st.checkbox("ãƒ•ã‚¡ã‚¤ãƒ«å", value=False, key="disp_filename")

        with col2:
            st.write("**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**")
            max_title = st.slider(
                "ã‚¿ã‚¤ãƒˆãƒ«æœ€å¤§æ–‡å­—æ•°",
                min_value=20,
                max_value=100,
                value=40,
                step=5,
                key="disp_max_title"
            )
            num_cols = st.select_slider(
                "ã‚«ãƒ©ãƒ æ•°",
                options=[1, 2, 3, 4, 5, 6],
                value=3,
                key="disp_num_cols"
            )

    return DisplaySettings(
        show_level_badge=show_level,
        show_availability_badge=show_avail,
        show_view_count_badge=show_views,
        show_storage_badge=show_storage,
        show_filesize_badge=show_filesize,
        show_modified_badge=show_modified,
        show_filename_badge=show_filename,
        max_title_length=max_title,
        num_columns=num_cols
    )
```

#### 6.3.3 å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆéª¨æ ¼ã®ã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `ui/components/video_card.py`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…éª¨æ ¼**:
```python
"""
ClipBox - å‹•ç”»ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
"""

import streamlit as st
from core.models import Video
from ui.components.display_settings import DisplaySettings


def render_video_card(
    video: Video,
    settings: DisplaySettings,
    show_judgment_ui: bool = True,
    is_selected: bool = False,
    on_play_callback=None,
    on_judge_callback=None
):
    """
    å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º

    Args:
        video: å‹•ç”»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        settings: è¡¨ç¤ºè¨­å®š
        show_judgment_ui: åˆ¤å®šUIã‚’è¡¨ç¤ºã™ã‚‹ã‹
        is_selected: é¸æŠä¸­ã‹ã©ã†ã‹
        on_play_callback: å†ç”Ÿãƒœã‚¿ãƒ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
        on_judge_callback: åˆ¤å®šãƒœã‚¿ãƒ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    """
    # TODO: å®Ÿè£…
    # - ãƒ¬ãƒ™ãƒ«ãƒãƒƒã‚¸ã®è¡¨ç¤º
    # - åˆ©ç”¨å¯å¦ãƒãƒƒã‚¸ã®è¡¨ç¤º
    # - ã‚¿ã‚¤ãƒˆãƒ«ã®è¡¨ç¤º
    # - å†ç”Ÿãƒœã‚¿ãƒ³
    # - åˆ¤å®šUIï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³+åˆ¤å®šãƒœã‚¿ãƒ³ï¼‰
    # - é¸æŠä¸­ã®å ´åˆã®å¼·èª¿è¡¨ç¤º
    pass


def _create_level_badge(level: int) -> str:
    """ãƒ¬ãƒ™ãƒ«ãƒãƒƒã‚¸ã®HTMLç”Ÿæˆ"""
    # TODO: å®Ÿè£…
    pass


def _create_availability_badge(is_available: bool) -> str:
    """åˆ©ç”¨å¯å¦ãƒãƒƒã‚¸ã®HTMLç”Ÿæˆ"""
    # TODO: å®Ÿè£…
    pass
```

### 6.4 ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] KPIè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] è¡¨ç¤ºè¨­å®šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] å„ã‚¿ãƒ–ã‹ã‚‰å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã›ã‚‹

---

## ğŸ¯ 7. ãƒ•ã‚§ãƒ¼ã‚º3: KPIè¡¨ç¤ºã®å®Ÿè£…

### 7.1 ç›®çš„

- å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã¨æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã«KPIã‚’è¡¨ç¤º
- åˆ¤å®šä½œæ¥­ã®é€²æ—ã‚’å¯è¦–åŒ–

### 7.2 å®Ÿè£…å†…å®¹

#### 7.2.1 å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã¸ã®KPIè¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `ui/library_tab.py`

**å®Ÿè£…**:
```python
from ui.components.kpi_display import render_kpi_cards, get_kpi_stats
from core.database import get_db_connection

def render_library_tab(on_play, on_judge):
    """å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã®æç”»ï¼ˆæ—¢å­˜é–¢æ•°ã‚’æ‹¡å¼µï¼‰"""
    st.header("ğŸ“š å‹•ç”»ä¸€è¦§")

    # â˜…NEW: KPIè¡¨ç¤º
    with get_db_connection() as conn:
        kpi_stats = get_kpi_stats(conn)

    render_kpi_cards(
        unrated_count=kpi_stats['unrated_count'],
        judged_count=kpi_stats['judged_count'],
        judged_rate=kpi_stats['judged_rate'],
        today_judged_count=kpi_stats['today_judged_count']
    )

    st.markdown("---")

    # ä»¥ä¸‹ã€æ—¢å­˜ã®å‹•ç”»ä¸€è¦§è¡¨ç¤ºå‡¦ç†
    # ...
```

### 7.3 ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] KPIãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ•°å€¤ãŒæ­£ç¢ºï¼ˆæ‰‹å‹•ç¢ºèªï¼‰

---

## ğŸ¯ 8. ãƒ•ã‚§ãƒ¼ã‚º4: æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®å®Ÿè£…

### 8.1 ç›®çš„

- æœªåˆ¤å®šå‹•ç”»ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æŠ½å‡ºã—ã¦è¡¨ç¤º
- åˆ¤å®šä½œæ¥­ã®åŠ¹ç‡åŒ–

### 8.2 å®Ÿè£…å†…å®¹

**ãƒ•ã‚¡ã‚¤ãƒ«**: `ui/unrated_random_tab.py`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…éª¨æ ¼**:
```python
"""
ClipBox - æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–
æœªåˆ¤å®šå‹•ç”»ï¼ˆãƒ¬ãƒ™ãƒ«-1ï¼‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡ºã—ã¦è¡¨ç¤º
"""

import streamlit as st
import random
from core.database import get_db_connection
from core.video_manager import VideoManager
from ui.components.kpi_display import render_kpi_cards, get_kpi_stats
from ui.components.display_settings import render_display_settings
from ui.components.video_card import render_video_card


def render_unrated_random_tab(on_play, on_judge):
    """
    æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®æç”»

    Args:
        on_play: å†ç”Ÿãƒœã‚¿ãƒ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
        on_judge: åˆ¤å®šãƒœã‚¿ãƒ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    """
    st.header("ğŸ² æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ")

    # KPIè¡¨ç¤º
    with get_db_connection() as conn:
        kpi_stats = get_kpi_stats(conn)

    render_kpi_cards(
        unrated_count=kpi_stats['unrated_count'],
        judged_count=kpi_stats['judged_count'],
        judged_rate=kpi_stats['judged_rate'],
        today_judged_count=kpi_stats['today_judged_count']
    )

    st.markdown("---")

    # ä»¶æ•°é¸æŠ
    col1, col2 = st.columns([3, 1])
    with col1:
        num_videos = st.select_slider(
            "è¡¨ç¤ºä»¶æ•°",
            options=[10, 20, 30, 50],
            value=20,
            key="unrated_num_videos"
        )
    with col2:
        if st.button("ğŸ”„ ã‚·ãƒ£ãƒƒãƒ•ãƒ«", use_container_width=True):
            st.session_state.unrated_shuffle_trigger = True
            st.rerun()

    # è¡¨ç¤ºè¨­å®š
    settings = render_display_settings()

    st.markdown("---")

    # æœªåˆ¤å®šå‹•ç”»ã‚’å–å¾—
    with get_db_connection() as conn:
        cursor = conn.execute("""
            SELECT * FROM videos
            WHERE current_favorite_level = -1
              AND is_available = 1
              AND is_deleted = 0
            ORDER BY RANDOM()
            LIMIT ?
        """, (num_videos,))

        videos = cursor.fetchall()

    if not videos:
        st.info("æœªåˆ¤å®šå‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“")
        return

    # å‹•ç”»ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
    cols = st.columns(settings.num_columns)
    for idx, video_data in enumerate(videos):
        with cols[idx % settings.num_columns]:
            # TODO: Video ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
            # TODO: render_video_card() ã§è¡¨ç¤º
            pass
```

**streamlit_app.pyã¸ã®è¿½åŠ **:
```python
from ui.unrated_random_tab import render_unrated_random_tab

# ã‚¿ãƒ–å®šç¾©ã‚’å¤‰æ›´
tab_library, tab_unrated, tab_analysis, tab_random, tab_stats, tab_snapshot, tab_settings = st.tabs(
    ["å‹•ç”»ä¸€è¦§", "æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ", "åˆ†æ", "ãƒ©ãƒ³ãƒ€ãƒ å†ç”Ÿ", "çµ±è¨ˆ", "ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ", "è¨­å®š"]
)

# ...

with tab_unrated:
    render_unrated_random_tab(play_handler, _handle_judgment)
```

### 8.3 ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] æœªåˆ¤å®šå‹•ç”»ãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹
- [ ] ä»¶æ•°é¸æŠãŒå‹•ä½œã™ã‚‹
- [ ] ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãƒœã‚¿ãƒ³ãŒå‹•ä½œã™ã‚‹
- [ ] åˆ¤å®šæ¸ˆã¿å‹•ç”»ãŒã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- [ ] åˆ¤å®šå¾Œã‚‚ç”»é¢ã«æ®‹ã‚‹

---

## ğŸ¯ 9. ãƒ•ã‚§ãƒ¼ã‚º5: åˆ†æã‚¿ãƒ–ã®æ‹¡å¼µ

### 9.1 ç›®çš„

- åˆ¤å®šå¾Œã®å¿œç­”é€Ÿåº¦ã‚’å¯è¦–åŒ–
- ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æŠŠæ¡

### 9.2 å®Ÿè£…å†…å®¹

#### 9.2.1 åˆ¤å®šå‡¦ç†ã§ã®å¿œç­”é€Ÿåº¦è¨˜éŒ²

**ãƒ•ã‚¡ã‚¤ãƒ«**: `core/app_service.py`ï¼ˆæ—¢å­˜é–¢æ•°ã‚’æ‹¡å¼µï¼‰

**å®Ÿè£…**:
```python
from datetime import datetime

def set_favorite_level_with_rename(video_id: int, new_level: int) -> dict:
    """
    ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒ™ãƒ«ã‚’å¤‰æ›´ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒãƒ¼ãƒ ï¼ˆæ—¢å­˜é–¢æ•°ã‚’æ‹¡å¼µï¼‰

    Args:
        video_id: å‹•ç”»ID
        new_level: æ–°ã—ã„ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒ™ãƒ«

    Returns:
        dict: å®Ÿè¡Œçµæœ
    """
    # åˆ¤å®šé–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²
    judged_at = datetime.now()

    # æ—¢å­˜ã®ãƒªãƒãƒ¼ãƒ å‡¦ç†
    # ...

    # ãƒªãƒãƒ¼ãƒ å®Œäº†æ™‚åˆ»ã‚’è¨˜éŒ²
    rename_completed_at = datetime.now()
    rename_duration_ms = int((rename_completed_at - judged_at).total_seconds() * 1000)

    # judgment_historyã«è¨˜éŒ²
    try:
        with get_db_connection() as conn:
            # å¤ã„ãƒ¬ãƒ™ãƒ«ã‚’å–å¾—
            cursor = conn.execute("SELECT current_favorite_level, storage_location FROM videos WHERE id = ?", (video_id,))
            row = cursor.fetchone()
            old_level = row[0] if row else None
            storage_location = row[1] if row else None

            # å±¥æ­´ã«è¨˜éŒ²
            conn.execute("""
                INSERT INTO judgment_history (
                    video_id, old_level, new_level, judged_at,
                    rename_completed_at, rename_duration_ms, storage_location
                )
                VALUES (?, ?, ?, ?, ?, ?, ?)
            """, (video_id, old_level, new_level, judged_at, rename_completed_at, rename_duration_ms, storage_location))
    except Exception as e:
        print(f"åˆ¤å®šå±¥æ­´ã®è¨˜éŒ²ã«å¤±æ•—: {e}")

    # æ—¢å­˜ã®è¿”ã‚Šå€¤
    return result
```

#### 9.2.2 å¿œç­”é€Ÿåº¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `ui/analysis_tab.py`

**å®Ÿè£…**:
```python
import plotly.express as px
import plotly.graph_objects as go
import pandas as pd

def render_response_time_histogram():
    """åˆ¤å®šå¾Œã®å¿œç­”é€Ÿåº¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ """
    st.subheader("âš¡ åˆ¤å®šå¿œç­”é€Ÿåº¦")

    # ãƒ‡ãƒ¼ã‚¿å–å¾—
    with get_db_connection() as conn:
        cursor = conn.execute("""
            SELECT rename_duration_ms, storage_location
            FROM judgment_history
            WHERE rename_duration_ms IS NOT NULL
        """)
        data = cursor.fetchall()

    if not data:
        st.info("å¿œç­”é€Ÿåº¦ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“")
        return

    df = pd.DataFrame(data, columns=['duration_ms', 'storage'])

    # ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ä½œæˆ
    fig = px.histogram(
        df,
        x='duration_ms',
        color='storage',
        nbins=20,
        title='åˆ¤å®šå¾Œã®å¿œç­”é€Ÿåº¦åˆ†å¸ƒ',
        labels={'duration_ms': 'å¿œç­”é€Ÿåº¦ï¼ˆãƒŸãƒªç§’ï¼‰', 'storage': 'ä¿å­˜å ´æ‰€'},
        hover_data={'duration_ms': True}
    )

    # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­å®š
    fig.update_layout(
        xaxis_title="å¿œç­”é€Ÿåº¦ï¼ˆãƒŸãƒªç§’ï¼‰",
        yaxis_title="ä»¶æ•°",
        bargap=0.1
    )

    st.plotly_chart(fig, use_container_width=True)

    # çµ±è¨ˆæƒ…å ±
    st.write("**çµ±è¨ˆæƒ…å ±**")
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        st.metric("å¹³å‡", f"{df['duration_ms'].mean():.1f}ms")
    with col2:
        st.metric("ä¸­å¤®å€¤", f"{df['duration_ms'].median():.1f}ms")
    with col3:
        st.metric("æœ€å¤§", f"{df['duration_ms'].max():.0f}ms")
    with col4:
        st.metric("æœ€å°", f"{df['duration_ms'].min():.0f}ms")
```

### 9.3 ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä¿å­˜å ´æ‰€åˆ¥ã®è‰²åˆ†ã‘ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ›ãƒãƒ¼æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] çµ±è¨ˆæƒ…å ±ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹

---

## ğŸ¯ 10. ãƒ•ã‚§ãƒ¼ã‚º6: UIæ”¹å–„ï¼ˆé¸æŠä¸­ã‚«ãƒ¼ãƒ‰å¼·èª¿ãªã©ï¼‰

### 10.1 ç›®çš„

- é¸æŠä¸­ã®ã‚«ãƒ¼ãƒ‰ã‚’è¦–è¦šçš„ã«å¼·èª¿
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š

### 10.2 å®Ÿè£…å†…å®¹

**ãƒ•ã‚¡ã‚¤ãƒ«**: `ui/components/video_card.py`

**å®Ÿè£…**:
```python
def render_video_card(
    video: Video,
    settings: DisplaySettings,
    show_judgment_ui: bool = True,
    is_selected: bool = False,
    on_play_callback=None,
    on_judge_callback=None
):
    """å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º"""

    # é¸æŠä¸­ã®å ´åˆã€èƒŒæ™¯è‰²ã¨æ ç·šã‚’å¤‰æ›´
    if is_selected:
        st.markdown("""
        <style>
        div[data-testid="stVerticalBlock"]:has(.selected-card) {
            background-color: #fef3c7 !important;
            border: 3px solid #f59e0b !important;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
        }
        </style>
        """, unsafe_allow_html=True)
        st.markdown('<div class="selected-card"></div>', unsafe_allow_html=True)

    # ä»¥ä¸‹ã€ã‚«ãƒ¼ãƒ‰å†…å®¹ã®æç”»
    # ...
```

**streamlit_app.pyã§ã®ä½¿ç”¨**:
```python
def _handle_play(video, trigger: str):
    """å†ç”Ÿã¨å±¥æ­´è¨˜éŒ²ã‚’ã¾ã¨ã‚ã¦å®Ÿè¡Œï¼ˆæ—¢å­˜é–¢æ•°ã‚’æ‹¡å¼µï¼‰"""
    # æ—¢å­˜ã®å‡¦ç†
    # ...

    # é¸æŠä¸­ã®å‹•ç”»ã¨ã—ã¦è¨˜éŒ²
    st.session_state.selected_video = video
    st.toast("å†ç”Ÿã‚’é–‹å§‹ã—ã¾ã—ãŸ")
```

### 10.3 ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚«ãƒ¼ãƒ‰ãŒå¼·èª¿ã•ã‚Œã‚‹
- [ ] åˆ¤å®šãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚«ãƒ¼ãƒ‰ãŒå¼·èª¿ã•ã‚Œã‚‹
- [ ] æ¬¡ã®æ“ä½œã§å‰ã®é¸æŠãŒè§£é™¤ã•ã‚Œã‚‹

---

## ğŸ§ª 11. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 11.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/test_scanner.py`ï¼ˆæ—¢å­˜ãƒ†ã‚¹ãƒˆã‚’æ‹¡å¼µï¼‰

```python
def test_extract_essential_filename_level_minus_1():
    """ãƒ¬ãƒ™ãƒ«-1ã®ãƒ†ã‚¹ãƒˆ"""
    # ?_ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹
    assert extract_essential_filename("?_ä½œå“å.mp4") == (-1, "ä½œå“å.mp4")

    # ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—
    assert extract_essential_filename("ä½œå“å.mp4") == (-1, "ä½œå“å.mp4")

def test_extract_essential_filename_level_0_to_4():
    """ãƒ¬ãƒ™ãƒ«0-4ã®ãƒ†ã‚¹ãƒˆ"""
    assert extract_essential_filename("_ä½œå“å.mp4") == (0, "ä½œå“å.mp4")
    assert extract_essential_filename("#_ä½œå“å.mp4") == (1, "ä½œå“å.mp4")
    assert extract_essential_filename("##_ä½œå“å.mp4") == (2, "ä½œå“å.mp4")
    assert extract_essential_filename("###_ä½œå“å.mp4") == (3, "ä½œå“å.mp4")
    assert extract_essential_filename("####_ä½œå“å.mp4") == (4, "ä½œå“å.mp4")
```

**æ–°è¦ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/test_migration.py`

```python
import pytest
from pathlib import Path
from core.migration import Migration
from core.database import get_db_connection

def test_migrate_level_0_to_minus_1():
    """ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã®ãƒ†ã‚¹ãƒˆ"""
    # TODO: å®Ÿè£…
    pass
```

### 11.2 çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã®å‹•ä½œç¢ºèª
- [ ] æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–ã®å‹•ä½œç¢ºèª
- [ ] åˆ†æã‚¿ãƒ–ã®å‹•ä½œç¢ºèª
- [ ] ã‚¿ãƒ–é–“ã®åˆ‡ã‚Šæ›¿ãˆå‹•ä½œç¢ºèª

### 11.3 UIãƒ†ã‚¹ãƒˆ

- [ ] å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¡¨ç¤ºç¢ºèª
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã®ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºç¢ºèª

---

## âš ï¸ 12. ãƒªã‚¹ã‚¯ã¨æ³¨æ„äº‹é …

### 12.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ãƒªã‚¹ã‚¯**:
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã«ãƒ‡ãƒ¼ã‚¿ãŒç ´æã™ã‚‹å¯èƒ½æ€§
- æ—¢å­˜ã®å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã®èª¤ã£ãŸåˆ†é¡

**å¯¾ç­–**:
- å®Ÿè¡Œå‰ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ¨å¥¨
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ãƒ•ãƒ©ã‚°ã§äºŒé‡å®Ÿè¡Œã‚’é˜²æ­¢
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã®ãƒ­ã‚°è¨˜éŒ²

### 12.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

**ãƒªã‚¹ã‚¯**:
- ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®is_availableæ›´æ–°ã§æ™‚é–“ãŒã‹ã‹ã‚‹ï¼ˆæ•°åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- KPIè¨ˆç®—ã‚¯ã‚¨ãƒªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

**å¯¾ç­–**:
- é€²æ—ãƒãƒ¼ã®è¡¨ç¤º
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®é©åˆ‡ãªè¨­å®š
- éåŒæœŸå‡¦ç†ã®æ¤œè¨ï¼ˆå°†æ¥ï¼‰

### 12.3 ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æ‰±ã„

**ãƒªã‚¹ã‚¯**:
- Windows/Linux/Macã§ãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ãŒç•°ãªã‚‹
- æ—¥æœ¬èªãƒ‘ã‚¹ã®æ–‡å­—åŒ–ã‘

**å¯¾ç­–**:
- `pathlib.Path`ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¦OSã«ä¾å­˜ã—ãªã„å‡¦ç†
- UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®å¾¹åº•

### 12.4 æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿

**ãƒªã‚¹ã‚¯**:
- `extract_essential_filename()`ã®å¤‰æ›´ã«ã‚ˆã‚Šã€æ—¢å­˜ã®å‹•ç”»ä¸€è¦§ãŒå½±éŸ¿ã‚’å—ã‘ã‚‹
- ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ã®å‹•ç”»ãŒãƒ¬ãƒ™ãƒ«0ã‹ã‚‰ãƒ¬ãƒ™ãƒ«-1ã«å¤‰ã‚ã‚‹

**å¯¾ç­–**:
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- æ®µéšçš„ãªãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®äº‹å‰èª¬æ˜

---

## ğŸ“… 13. å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¦‹ç©ã‚‚ã‚Š

### 13.1 è©³ç´°è¦‹ç©ã‚‚ã‚Š

| ãƒ•ã‚§ãƒ¼ã‚º | ã‚¿ã‚¹ã‚¯ | æ‰€è¦æ™‚é–“ |
|----------|--------|----------|
| ãƒ•ã‚§ãƒ¼ã‚º1 | judgment_historyãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ | 1æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º1 | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†å®Ÿè£… | 1-2æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º1 | `extract_essential_filename()`ä¿®æ­£ | 0.5-1æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º2 | ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆå¤‰æ›´ | 1æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º2 | KPIè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | 1-2æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º2 | è¡¨ç¤ºè¨­å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | 1æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º2 | å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | 1-2æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º3 | KPIçµ±è¨ˆè¨ˆç®—å®Ÿè£… | 1-2æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º3 | å‹•ç”»ä¸€è¦§ã‚¿ãƒ–ã¸ã®KPIè¿½åŠ  | 1æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º4 | æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ–å®Ÿè£… | 3-4æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º5 | å¿œç­”é€Ÿåº¦è¨˜éŒ²å‡¦ç† | 1æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º5 | å¿œç­”é€Ÿåº¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ  | 1-2æ™‚é–“ |
| ãƒ•ã‚§ãƒ¼ã‚º6 | é¸æŠä¸­ã‚«ãƒ¼ãƒ‰å¼·èª¿ | 2-3æ™‚é–“ |
| ãƒ†ã‚¹ãƒˆ | å…¨ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒ†ã‚¹ãƒˆ | 3-5æ™‚é–“ |

**åˆè¨ˆ**: 19-30æ™‚é–“

### 13.2 æ¨å¥¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

ClipBoxã®æ”¹ä¿®ã‚’æ®µéšçš„ã«é€²ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š

- **Day 1**: ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆ2-3æ™‚é–“ï¼‰- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç›¤æ•´å‚™
- **Day 2**: ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆ4-6æ™‚é–“ï¼‰- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±é€šåŒ–
- **Day 3**: ãƒ•ã‚§ãƒ¼ã‚º3, 4ï¼ˆ6-8æ™‚é–“ï¼‰- KPIã¨æœªåˆ¤å®šãƒ©ãƒ³ãƒ€ãƒ 
- **Day 4**: ãƒ•ã‚§ãƒ¼ã‚º5, 6ï¼ˆ4-6æ™‚é–“ï¼‰- åˆ†æã¨UIæ”¹å–„
- **Day 5**: ãƒ†ã‚¹ãƒˆã¨èª¿æ•´ï¼ˆ3-5æ™‚é–“ï¼‰

---

## ğŸ“ è£œè¶³äº‹é …

### ãƒ•ã‚¡ã‚¤ãƒ«åãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# extract_essential_filename()ã®æœŸå¾…å‹•ä½œ

"####_ä½œå“å.mp4"  -> (4, "ä½œå“å.mp4")   # ãƒ¬ãƒ™ãƒ«4
"###_ä½œå“å.mp4"   -> (3, "ä½œå“å.mp4")   # ãƒ¬ãƒ™ãƒ«3
"##_ä½œå“å.mp4"    -> (2, "ä½œå“å.mp4")   # ãƒ¬ãƒ™ãƒ«2
"#_ä½œå“å.mp4"     -> (1, "ä½œå“å.mp4")   # ãƒ¬ãƒ™ãƒ«1
"_ä½œå“å.mp4"      -> (0, "ä½œå“å.mp4")   # ãƒ¬ãƒ™ãƒ«0
"?_ä½œå“å.mp4"     -> (-1, "ä½œå“å.mp4")  # ãƒ¬ãƒ™ãƒ«-1ï¼ˆæ˜ç¤ºçš„æœªåˆ¤å®šï¼‰
"ä½œå“å.mp4"       -> (-1, "ä½œå“å.mp4")  # ãƒ¬ãƒ™ãƒ«-1ï¼ˆãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ï¼‰
```

### ãƒ¬ãƒ™ãƒ«ã®æ„å‘³

- **ãƒ¬ãƒ™ãƒ«-1**: æœªåˆ¤å®šï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å: `?_`ã¾ãŸã¯ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ï¼‰
- **ãƒ¬ãƒ™ãƒ«0**: åˆ¤å®šæ¸ˆã¿ã ãŒç‰¹ã«æ°—ã«å…¥ã£ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å: `_`ï¼‰
- **ãƒ¬ãƒ™ãƒ«1**: ã‚„ã‚„æ°—ã«å…¥ã£ã¦ã„ã‚‹ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å: `#_`ï¼‰
- **ãƒ¬ãƒ™ãƒ«2**: ãŠæ°—ã«å…¥ã‚Šï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å: `##_`ï¼‰
- **ãƒ¬ãƒ™ãƒ«3**: æœ€ã‚‚ãŠæ°—ã«å…¥ã‚Šï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å: `###_`ï¼‰
- **ãƒ¬ãƒ™ãƒ«4**: è¶…ãŠæ°—ã«å…¥ã‚Šï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å: `####_`ï¼‰

### config.pyã¸ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `config.py`

```python
# ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒ™ãƒ«ã®è¡¨ç¤ºåï¼ˆæ—¢å­˜ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’æ‹¡å¼µï¼‰
FAVORITE_LEVEL_NAMES = {
    -1: 'æœªåˆ¤å®š',      # â˜…NEWâ˜…
    0: 'ãƒ¬ãƒ™ãƒ«0',
    1: 'ãƒ¬ãƒ™ãƒ«1',
    2: 'ãƒ¬ãƒ™ãƒ«2',
    3: 'ãƒ¬ãƒ™ãƒ«3',
    4: 'ãƒ¬ãƒ™ãƒ«4',
}
```

---

## çµ‚ã‚ã‚Šã«

ã“ã®å®Ÿè£…è¨ˆç”»æ›¸ã«å¾“ã£ã¦ã€æ®µéšçš„ã«æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚å„ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†å¾Œã«ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã€å•é¡ŒãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã«é€²ã‚€ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

**é‡è¦ãªæ³¨æ„äº‹é …**:
1. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå‰ã«å¿…ãšãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
2. **æ®µéšçš„å®Ÿè£…**: ä¸€åº¦ã«ã™ã¹ã¦ã‚’å®Ÿè£…ã›ãšã€ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã«ç¢ºèª
3. **ãƒ†ã‚¹ãƒˆ**: å„ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†å¾Œã«å¿…ãšãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½

å®Ÿè£…ä¸­ã«ä¸æ˜ç‚¹ã‚„å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€é©å®œç›¸è«‡ã—ã¦ãã ã•ã„ã€‚

---

**ä½œæˆè€…**: Claude Code
**æ›´æ–°æ—¥**: 2026-01-15
